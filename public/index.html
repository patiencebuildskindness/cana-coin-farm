<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>CANA - Medicinal Plant World</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0a1f1b, #1a3d34);
            color: #e0f2e9;
            overflow: hidden;
            position: relative;
            height: 100vh;
        }

        /* Game World Canvas */
        .game-world {
            position: relative;
            width: 100%;
            height: 100vh;
            overflow: auto;
            background-image: 
                radial-gradient(circle at 20% 50%, rgba(34, 197, 94, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(74, 222, 128, 0.1) 0%, transparent 50%);
        }

        /* Top HUD */
        .top-hud {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: linear-gradient(180deg, rgba(10, 31, 27, 0.98), rgba(10, 31, 27, 0.85));
            backdrop-filter: blur(10px);
            padding: 10px;
            z-index: 1000;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.5);
        }

        .player-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .player-level {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #22c55e, #16a34a);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            border: 2px solid #4ade80;
        }

        .level-badge {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            padding: 5px 12px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 14px;
        }

        .resources {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .resource {
            display: flex;
            align-items: center;
            gap: 5px;
            background: rgba(34, 197, 94, 0.1);
            padding: 5px 10px;
            border-radius: 15px;
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        .resource-icon {
            font-size: 16px;
        }

        .resource-amount {
            font-weight: bold;
            color: #4ade80;
        }

        /* Farm View */
        .farm-container {
            position: relative;
            padding: 80px 10px 80px 10px;
            min-height: 100vh;
        }

        .farm-grid {
            display: grid;
            grid-template-columns: repeat(8, 60px);
            grid-template-rows: repeat(8, 60px);
            gap: 5px;
            margin: 20px auto;
            width: fit-content;
            transform: perspective(1000px) rotateX(35deg);
            transform-style: preserve-3d;
        }

        .plot {
            width: 60px;
            height: 60px;
            background: radial-gradient(circle, rgba(101, 67, 33, 0.6), rgba(78, 52, 26, 0.4));
            border: 2px solid #8b5c2e;
            border-radius: 8px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s;
            transform-style: preserve-3d;
        }

        .plot:hover {
            transform: translateZ(10px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        }

        .plot-plant {
            position: absolute;
            bottom: 5px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 30px;
            filter: drop-shadow(2px 2px 4px rgba(0, 0, 0, 0.5));
            animation: sway 3s infinite ease-in-out;
        }

        @keyframes sway {
            0%, 100% { transform: translateX(-50%) rotate(-2deg); }
            50% { transform: translateX(-50%) rotate(2deg); }
        }

        .plot-timer {
            position: absolute;
            bottom: -20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 10px;
            white-space: nowrap;
        }

        .plot-ready {
            animation: pulse 1s infinite;
            background: radial-gradient(circle, rgba(251, 191, 36, 0.4), rgba(245, 158, 11, 0.3));
            border-color: #fbbf24;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* Buildings */
        .buildings-row {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px auto;
            flex-wrap: wrap;
        }

        .building {
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(37, 99, 235, 0.1));
            border: 2px solid #3b82f6;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .building:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.4);
        }

        .building-icon {
            font-size: 40px;
            margin-bottom: 5px;
        }

        .building-name {
            font-size: 11px;
            font-weight: bold;
        }

        /* Neighbor Farms */
        .neighbors-strip {
            display: flex;
            gap: 15px;
            padding: 10px;
            overflow-x: auto;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            margin: 20px 10px;
        }

        .neighbor-farm {
            min-width: 80px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .neighbor-farm:hover {
            transform: scale(1.1);
        }

        .neighbor-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #a855f7, #9333ea);
            margin: 0 auto 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            border: 2px solid #c084fc;
        }

        .neighbor-name {
            font-size: 11px;
            opacity: 0.9;
        }

        .neighbor-level {
            font-size: 10px;
            color: #fbbf24;
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(0deg, rgba(10, 31, 27, 0.98), rgba(10, 31, 27, 0.85));
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: space-around;
            padding: 8px 0;
            z-index: 1000;
        }

        .nav-item {
            flex: 1;
            background: none;
            border: none;
            color: #e0f2e9;
            padding: 5px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 3px;
        }

        .nav-item:hover, .nav-item.active {
            color: #4ade80;
        }

        .nav-item.active {
            background: rgba(34, 197, 94, 0.1);
            border-radius: 10px;
        }

        .nav-icon {
            font-size: 20px;
        }

        .nav-label {
            font-size: 10px;
        }

        /* Modals */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: linear-gradient(135deg, #1a3d34, #0f2922);
            border-radius: 20px;
            padding: 20px;
            max-width: 500px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            border: 2px solid #22c55e;
            animation: slideUp 0.3s;
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            border-bottom: 1px solid rgba(34, 197, 94, 0.3);
            padding-bottom: 10px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: bold;
            color: #4ade80;
        }

        .close-btn {
            background: none;
            border: none;
            color: #ef4444;
            font-size: 24px;
            cursor: pointer;
        }

        /* Market */
        .market-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }

        .market-item {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.3);
            border-radius: 10px;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

       .market-item:hover {
    transform: scale(1.05);
    border-color: #4ade80;
    box-shadow: 0 5px 15px rgba(34, 197, 94, 0.3);
}

.market-item.locked {
    opacity: 0.5;
    cursor: not-allowed;
    background: rgba(239, 68, 68, 0.1);
}

.market-item.locked:hover {
    transform: none;
    border-color: #ef4444;
}
        }

        .market-item-icon {
            font-size: 30px;
            margin-bottom: 5px;
        }

        .market-item-name {
            font-size: 11px;
            margin-bottom: 3px;
        }

        .market-item-price {
            font-size: 12px;
            color: #fbbf24;
            font-weight: bold;
        }

        /* Friends List */
        .friends-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .friend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: rgba(34, 197, 94, 0.05);
            border-radius: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .friend-item:hover {
            background: rgba(34, 197, 94, 0.15);
        }

        .friend-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ec4899, #db2777);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .friend-info {
            flex: 1;
        }

        .friend-name {
            font-weight: bold;
            margin-bottom: 2px;
        }

        .friend-status {
            font-size: 11px;
            color: #4ade80;
        }

        .friend-actions {
            display: flex;
            gap: 5px;
        }

        .action-btn {
            background: rgba(34, 197, 94, 0.2);
            border: 1px solid #22c55e;
            color: #4ade80;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .action-btn:hover {
            background: #22c55e;
            color: white;
        }

        /* Factory System */
        .factory-machines {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .machine {
            background: linear-gradient(135deg, rgba(168, 85, 247, 0.2), rgba(147, 51, 234, 0.1));
            border: 2px solid #a855f7;
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            position: relative;
        }

        .machine-icon {
            font-size: 40px;
            margin-bottom: 5px;
        }

        .machine-name {
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .machine-status {
            font-size: 11px;
            color: #fbbf24;
        }

        .machine-progress {
            height: 4px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 2px;
            margin-top: 5px;
            overflow: hidden;
        }

        .machine-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #22c55e, #4ade80);
            transition: width 0.3s;
        }

        /* Inventory Grid */
        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 10px;
            margin: 15px 0;
            max-height: 300px;
            overflow-y: auto;
        }

        .inventory-item {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid #3b82f6;
            border-radius: 8px;
            padding: 8px;
            text-align: center;
            position: relative;
        }

        .inventory-icon {
            font-size: 30px;
        }

        .inventory-count {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #ef4444;
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: bold;
        }

        .inventory-name {
            font-size: 10px;
            margin-top: 3px;
        }

        /* Achievement Toast */
        .achievement-toast {
            position: fixed;
            top: 80px;
            right: -300px;
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: #0a1f1b;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            transition: right 0.5s;
            z-index: 3000;
            max-width: 250px;
        }

        .achievement-toast.show {
            right: 20px;
        }

        .achievement-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 5px;
        }

        .achievement-icon {
            font-size: 30px;
        }

        .achievement-title {
            font-weight: bold;
            font-size: 14px;
        }

        .achievement-desc {
            font-size: 12px;
            opacity: 0.9;
        }

        /* Daily Bonus Calendar */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin: 15px 0;
        }

        .calendar-day {
            aspect-ratio: 1;
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.3);
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .calendar-day.collected {
            background: rgba(34, 197, 94, 0.3);
            border-color: #22c55e;
        }

        .calendar-day.today {
            animation: pulse 2s infinite;
            border-color: #fbbf24;
        }

        .day-number {
            font-size: 10px;
            opacity: 0.7;
        }

        .day-reward {
            font-size: 20px;
        }

        /* Floating Notifications */
        .floating-text {
            position: fixed;
            color: #4ade80;
            font-weight: bold;
            font-size: 18px;
            pointer-events: none;
            animation: floatUp 2s ease-out;
            z-index: 4000;
        }

        @keyframes floatUp {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-100px); opacity: 0; }
        }

        /* Weather Effects */
        .weather-indicator {
            position: absolute;
            top: 60px;
            right: 10px;
            background: rgba(0, 0, 0, 0.5);
            padding: 5px 10px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .weather-icon {
            font-size: 20px;
        }

        .weather-text {
            font-size: 12px;
        }

        /* Energy Bar */
        .energy-container {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 3px;
            margin: 5px 0;
        }

        .energy-bar {
            height: 20px;
            background: linear-gradient(90deg, #fbbf24, #f59e0b);
            border-radius: 7px;
            position: relative;
            transition: width 0.5s;
        }

        .energy-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 11px;
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }
    </style>
</head>
<body>
    <!-- Top HUD -->
    <div class="top-hud">
        <div class="player-info">
            <div class="player-level">
                <div class="avatar">🧑‍🌾</div>
                <div>
                    <div style="font-size: 14px; font-weight: bold;">Farmer <span id="playerName">You</span></div>
                    <div class="level-badge">Level <span id="playerLevel">1</span></div>
                </div>
            </div>
            <div style="text-align: right;">
                <div style="font-size: 11px; opacity: 0.8;">Farm <span id="farmNumber">1</span>/51</div>
                <div style="font-size: 10px; color: #4ade80;">XP: <span id="playerXP">0</span>/100</div>
            </div>
        </div>
        <div class="resources">
            <div class="resource">
                <span class="resource-icon">💰</span>
                <span class="resource-amount" id="coins">1000</span>
            </div>
            <div class="resource">
                <span class="resource-icon">💎</span>
                <span class="resource-amount" id="gems">10</span>
            </div>
            <div class="resource">
                <span class="resource-icon">🌿</span>
                <span class="resource-amount" id="herbs">0</span>
            </div>
            <div class="resource">
                <span class="resource-icon">🧪</span>
                <span class="resource-amount" id="extracts">0</span>
            </div>
        </div>
        <div class="energy-container">
            <div class="energy-bar" id="energyBar" style="width: 100%">
                <span class="energy-text">⚡ <span id="energy">100</span>/100</span>
            </div>
        </div>
    </div>

    <!-- Weather Indicator -->
    <div class="weather-indicator">
        <span class="weather-icon" id="weatherIcon">☀️</span>
        <span class="weather-text" id="weatherText">Sunny</span>
    </div>

    <!-- Game World -->
    <div class="game-world" id="gameWorld">
        <!-- Farm Container -->
        <div class="farm-container" id="farmView">
            <!-- Neighbor Farms Strip -->
            <div class="neighbors-strip">
                <div class="neighbor-farm" onclick="visitNeighbor(1)">
                    <div class="neighbor-avatar">👩</div>
                    <div class="neighbor-name">Sarah</div>
                    <div class="neighbor-level">Lvl 45</div>
                </div>
                <div class="neighbor-farm" onclick="visitNeighbor(2)">
                    <div class="neighbor-avatar">👨</div>
                    <div class="neighbor-name">Mike</div>
                    <div class="neighbor-level">Lvl 32</div>
                </div>
                <div class="neighbor-farm" onclick="visitNeighbor(3)">
                    <div class="neighbor-avatar">👧</div>
                    <div class="neighbor-name">Emma</div>
                    <div class="neighbor-level">Lvl 28</div>
                </div>
                <div class="neighbor-farm" onclick="visitNeighbor(4)">
                    <div class="neighbor-avatar">🧑</div>
                    <div class="neighbor-name">Alex</div>
                    <div class="neighbor-level">Lvl 51</div>
                </div>
                <div class="neighbor-farm" onclick="visitNeighbor(5)">
                    <div class="neighbor-avatar">👴</div>
                    <div class="neighbor-name">Elder</div>
                    <div class="neighbor-level">Lvl 127</div>
                </div>
            </div>

            <!-- Main Farm Grid -->
            <div class="farm-grid" id="farmGrid">
                <!-- 64 plots will be generated here -->
            </div>

            <!-- Buildings -->
            <div class="buildings-row">
                <div class="building" onclick="openFactory()">
                    <span class="building-icon">🏭</span>
                    <span class="building-name">Extract Lab</span>
                </div>
                <div class="building" onclick="openGreenhouse()">
                    <span class="building-icon">🏡</span>
                    <span class="building-name">Greenhouse</span>
                </div>
                <div class="building" onclick="openApothecary()">
                    <span class="building-icon">⚗️</span>
                    <span class="building-name">Apothecary</span>
                </div>
                <div class="building" onclick="openLibrary()">
                    <span class="building-icon">📚</span>
                    <span class="building-name">Library</span>
                </div>
                <div class="building" onclick="openFishPond()">
                    <span class="building-icon">🎣</span>
                    <span class="building-name">Koi Pond</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <div class="bottom-nav">
        <button class="nav-item active" onclick="showView('farm')">
            <span class="nav-icon">🌾</span>
            <span class="nav-label">Farm</span>
        </button>
        <button class="nav-item" onclick="showView('market')">
            <span class="nav-icon">🛒</span>
            <span class="nav-label">Market</span>
        </button>
        <button class="nav-item" onclick="showView('inventory')">
            <span class="nav-icon">📦</span>
            <span class="nav-label">Storage</span>
        </button>
        <button class="nav-item" onclick="showView('social')">
            <span class="nav-icon">👥</span>
            <span class="nav-label">Co-op</span>
        </button>
        <button class="nav-item" onclick="showView('quests')">
            <span class="nav-icon">⭐</span>
            <span class="nav-label">Quests</span>
        </button>
    </div>

    <!-- Market Modal -->
    <div class="modal" id="marketModal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="modal-title">🛒 Marketplace</span>
                <button class="close-btn" onclick="closeModal('marketModal')">✖</button>
            </div>
            <div class="market-grid" id="marketGrid">
                <!-- Market items will be generated here -->
            </div>
        </div>
    </div>

    <!-- Factory Modal -->
    <div class="modal" id="factoryModal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="modal-title">🏭 Extract Laboratory</span>
                <button class="close-btn" onclick="closeModal('factoryModal')">✖</button>
            </div>
            <div class="factory-machines">
                <div class="machine">
                    <div class="machine-icon">🧪</div>
                    <div class="machine-name">Tincture Press</div>
                    <div class="machine-status">Ready</div>
                    <div class="machine-progress">
                        <div class="machine-progress-fill" style="width: 0%"></div>
                    </div>
                </div>
                <div class="machine">
                    <div class="machine-icon">⚗️</div>
                    <div class="machine-name">Oil Distiller</div>
                    <div class="machine-status">Processing...</div>
                    <div class="machine-progress">
                        <div class="machine-progress-fill" style="width: 65%"></div>
                    </div>
                </div>
                <div class="machine">
                    <div class="machine-icon">🔬</div>
                    <div class="machine-name">Extract Maker</div>
                    <div class="machine-status">Ready</div>
                    <div class="machine-progress">
                        <div class="machine-progress-fill" style="width: 0%"></div>
                    </div>
                </div>
                <div class="machine">
                    <div class="machine-icon">💊</div>
                    <div class="machine-name">Capsule Filler</div>
                    <div class="machine-status">Locked (Lvl 15)</div>
                    <div class="machine-progress">
                        <div class="machine-progress-fill" style="width: 0%"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Social/Co-op Modal -->
    <div class="modal" id="socialModal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="modal-title">👥 Medicine Co-op</span>
                <button class="close-btn" onclick="closeModal('socialModal')">✖</button>
            </div>
            <div style="margin-bottom: 15px;">
                <div style="background: rgba(168, 85, 247, 0.1); border: 1px solid #a855f7; padding: 10px; border-radius: 10px;">
                    <div style="font-weight: bold; margin-bottom: 5px;">🎯 Weekly Goal: Harvest 10,000 Herbs</div>
                    <div style="font-size: 12px; margin-bottom: 5px;">Progress: 3,421/10,000</div>
                    <div style="height: 10px; background: rgba(0,0,0,0.3); border-radius: 5px; overflow: hidden;">
                        <div style="height: 100%; width: 34%; background: linear-gradient(90deg, #a855f7, #c084fc);"></div>
                    </div>
                </div>
            </div>
            <div class="friends-list">
                <div class="friend-item">
                    <div class="friend-avatar">👩</div>
                    <div class="friend-info">
                        <div class="friend-name">Sarah</div>
                        <div class="friend-status">🟢 Online - Harvesting</div>
                    </div>
                    <div class="friend-actions">
                        <button class="action-btn" onclick="sendGift(1)">Gift</button>
                        <button class="action-btn" onclick="helpFriend(1)">Help</button>
                    </div>
                </div>
                <div class="friend-item">
                    <div class="friend-avatar">👨</div>
                    <div class="friend-info">
                        <div class="friend-name">Mike</div>
                        <div class="friend-status">🔴 Offline - 2h ago</div>
                    </div>
                    <div class="friend-actions">
                        <button class="action-btn" onclick="sendGift(2)">Gift</button>
                        <button class="action-btn" onclick="helpFriend(2)">Help</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Achievement Toast -->
    <div class="achievement-toast" id="achievementToast">
        <div class="achievement-header">
            <span class="achievement-icon">🏆</span>
            <span class="achievement-title">Achievement!</span>
        </div>
        <div class="achievement-desc" id="achievementDesc">First Harvest!</div>
    </div>

    <script>
        // Initialize Telegram WebApp
        const tg = window.Telegram?.WebApp;
        if (tg) {
            tg.ready();
            tg.expand();
        }

        // Game State
        let gameState = {
            // Player stats
            level: 1,
            xp: 0,
            coins: 1000,
            gems: 10,
            herbs: 0,
            extracts: 0,
            energy: 100,
            maxEnergy: 100,
            currentFarm: 1,
            totalFarms: 1,
            
            // Farm data
            plots: Array(64).fill(null),
            buildings: {
                greenhouse: { level: 1, producing: false },
                lab: { level: 1, producing: false },
                apothecary: { level: 0, locked: true },
                library: { level: 0, locked: true },
                pond: { level: 0, locked: true }
            },
            
            // Social
            friends: [],
            coopProgress: 3421,
            coopGoal: 10000,
            
            // Weather
            weather: 'sunny',
            weatherBonus: 1.0,
            
            // Plants database
            plants: [
             plants: [
  {id: 1, name: 'Abuta', emoji: '🌿', growTime: 60, value: 25, xp: 10, level: 1},
  {id: 2, name: 'Acai', emoji: '🫐', growTime: 120, value: 50, xp: 20, level: 1},
  {id: 3, name: 'Acerola', emoji: '🍒', growTime: 90, value: 35, xp: 15, level: 1},
  {id: 4, name: 'Achiote', emoji: '🔴', growTime: 80, value: 30, xp: 12, level: 1},
  {id: 5, name: 'Agrimony', emoji: '🌼', growTime: 70, value: 28, xp: 11, level: 1},
  {id: 6, name: 'Alfalfa', emoji: '🌾', growTime: 45, value: 15, xp: 8, level: 1},
  {id: 7, name: 'Algae Red Marine', emoji: '🔴', growTime: 180, value: 100, xp: 40, level: 1},
  {id: 8, name: 'Allspice', emoji: '🫐', growTime: 100, value: 45, xp: 18, level: 1},
  {id: 9, name: 'Aloe Ferox', emoji: '🌵', growTime: 150, value: 65, xp: 25, level: 1},
  {id: 10, name: 'Aloe Vera', emoji: '🌵', growTime: 60, value: 20, xp: 10, level: 1},
  {id: 11, name: 'Amalaki', emoji: '🟢', growTime: 140, value: 60, xp: 24, level: 1},
  {id: 12, name: 'Amor Seco', emoji: '🌿', growTime: 75, value: 32, xp: 13, level: 1},
  {id: 13, name: 'Anamu', emoji: '🌱', growTime: 85, value: 38, xp: 15, level: 1},
  {id: 14, name: 'Andiroba', emoji: '🌳', growTime: 200, value: 120, xp: 45, level: 1},
  {id: 15, name: 'Angelica', emoji: '⚪', growTime: 110, value: 48, xp: 19, level: 1},
  {id: 16, name: 'Anise', emoji: '⭐', growTime: 65, value: 25, xp: 11, level: 2},
  {id: 17, name: 'Apple Cider', emoji: '🍎', growTime: 50, value: 18, xp: 9, level: 2},
  {id: 18, name: 'Apple', emoji: '🍎', growTime: 55, value: 20, xp: 10, level: 2},
  {id: 19, name: 'Arnica', emoji: '🌻', growTime: 95, value: 42, xp: 17, level: 2},
  {id: 20, name: 'Arrowroot', emoji: '🏹', growTime: 70, value: 30, xp: 12, level: 2},
  {id: 21, name: 'Artichoke', emoji: '🥬', growTime: 120, value: 55, xp: 22, level: 2},
  {id: 22, name: 'Ashwagandha', emoji: '🌿', growTime: 180, value: 90, xp: 35, level: 2},
  {id: 23, name: 'Astragalus', emoji: '🌱', growTime: 160, value: 75, xp: 30, level: 2},
  {id: 24, name: 'Avocado', emoji: '🥑', growTime: 100, value: 45, xp: 18, level: 2},
  {id: 25, name: 'Ayahuma', emoji: '🌺', growTime: 240, value: 150, xp: 55, level: 2},
  {id: 26, name: 'Ayapana', emoji: '🌿', growTime: 90, value: 40, xp: 16, level: 2},
  {id: 27, name: 'Babul Chall Gum', emoji: '🌳', growTime: 130, value: 58, xp: 23, level: 2},
  {id: 28, name: 'Balsam Fir Needles', emoji: '🌲', growTime: 75, value: 33, xp: 13, level: 2},
  {id: 29, name: 'Banisteriopsis Caapi', emoji: '🌿', growTime: 300, value: 200, xp: 70, level: 2},
  {id: 30, name: 'Barberry', emoji: '🔴', growTime: 85, value: 37, xp: 15, level: 2},
  {id: 31, name: 'Barley Grass', emoji: '🌾', growTime: 60, value: 26, xp: 11, level: 3},
  {id: 32, name: 'Basil', emoji: '🌱', growTime: 45, value: 15, xp: 8, level: 3},
  {id: 33, name: 'Bat Petals Natural Sea Algae', emoji: '🌊', growTime: 170, value: 85, xp: 33, level: 3},
  {id: 34, name: 'Bay', emoji: '🍃', growTime: 80, value: 35, xp: 14, level: 3},
  {id: 35, name: 'Bayberry', emoji: '🫐', growTime: 95, value: 42, xp: 17, level: 3},
  {id: 36, name: 'Beet', emoji: '🔴', growTime: 70, value: 30, xp: 12, level: 3},
  {id: 37, name: 'Bellaco Caspi', emoji: '🌳', growTime: 210, value: 125, xp: 47, level: 3},
  {id: 38, name: 'Benzoin Gum', emoji: '🟤', growTime: 140, value: 62, xp: 25, level: 3},
  {id: 39, name: 'Bhringraj', emoji: '🌿', growTime: 110, value: 50, xp: 20, level: 3},
  {id: 40, name: 'Bibhitaki', emoji: '🌰', growTime: 160, value: 72, xp: 29, level: 3},
  {id: 41, name: 'Bilberry', emoji: '🫐', growTime: 90, value: 40, xp: 16, level: 3},
  {id: 42, name: 'Birch', emoji: '🌳', growTime: 100, value: 45, xp: 18, level: 3},
  {id: 43, name: 'Bitter Melon', emoji: '🥒', growTime: 85, value: 38, xp: 15, level: 3},
  {id: 44, name: 'Black Cohosh', emoji: '⚫', growTime: 150, value: 68, xp: 27, level: 3},
  {id: 45, name: 'Black Cumin', emoji: '⚫', growTime: 75, value: 33, xp: 13, level: 3},
  {id: 46, name: 'Black Currant', emoji: '🫐', growTime: 95, value: 42, xp: 17, level: 4},
  {id: 47, name: 'Black Walnut Hull', emoji: '🌰', growTime: 130, value: 58, xp: 23, level: 4},
  {id: 48, name: 'Blackberry', emoji: '🫐', growTime: 80, value: 35, xp: 14, level: 4},
  {id: 49, name: 'Bladderrack', emoji: '🌊', growTime: 165, value: 75, xp: 30, level: 4},
  {id: 50, name: 'Blessed Thistle', emoji: '🌸', growTime: 85, value: 38, xp: 15, level: 4},
  {id: 51, name: 'Blood', emoji: '🔴', growTime: 120, value: 54, xp: 22, level: 4},
  {id: 52, name: 'Blue Lily', emoji: '💙', growTime: 145, value: 65, xp: 26, level: 4},
  {id: 53, name: 'Blue Lotus', emoji: '🪷', growTime: 180, value: 82, xp: 33, level: 4},
  {id: 54, name: 'Blue Vervain', emoji: '💙', growTime: 95, value: 42, xp: 17, level: 4},
  {id: 55, name: 'Bobinsana', emoji: '🌺', growTime: 220, value: 110, xp: 44, level: 4},
  {id: 56, name: 'Boneset', emoji: '🌿', growTime: 75, value: 33, xp: 13, level: 4},
  {id: 57, name: 'Boswellia Serrata', emoji: '🌳', growTime: 190, value: 95, xp: 38, level: 4},
  {id: 58, name: 'Brahmi', emoji: '🌱', growTime: 125, value: 56, xp: 22, level: 4},
  {id: 59, name: 'Buckthorn', emoji: '🌿', growTime: 85, value: 38, xp: 15, level: 4},
  {id: 60, name: 'Buckwheat Hulls', emoji: '🌾', growTime: 60, value: 26, xp: 11, level: 4},
  {id: 61, name: 'Bufellio', emoji: '🌳', growTime: 200, value: 100, xp: 40, level: 5},
  {id: 62, name: 'Bupleurum', emoji: '🌿', growTime: 115, value: 52, xp: 21, level: 5},
  {id: 63, name: 'Burdock', emoji: '🌱', growTime: 90, value: 40, xp: 16, level: 5},
  {id: 64, name: 'Buriti', emoji: '🌴', growTime: 185, value: 92, xp: 37, level: 5},
  {id: 65, name: 'Butchers Broom', emoji: '🌿', growTime: 100, value: 45, xp: 18, level: 5},
  {id: 66, name: 'Butterfly Pea', emoji: '🦋', growTime: 135, value: 60, xp: 24, level: 5},
  {id: 67, name: 'Butternut', emoji: '🌰', growTime: 110, value: 50, xp: 20, level: 5},
  {id: 68, name: 'Cacao Peru', emoji: '🍫', growTime: 170, value: 85, xp: 34, level: 5},
  {id: 69, name: 'Calamus', emoji: '🌿', growTime: 95, value: 42, xp: 17, level: 5},
  {id: 70, name: 'California Poppy', emoji: '🌺', growTime: 105, value: 47, xp: 19, level: 5},
  {id: 71, name: 'Camu Camu', emoji: '🟠', growTime: 155, value: 70, xp: 28, level: 5},
  {id: 72, name: 'Cannabis', emoji: '🌿', growTime: 240, value: 150, xp: 60, level: 5},
  {id: 73, name: 'Caneleiro', emoji: '🌳', growTime: 195, value: 98, xp: 39, level: 5},
  {id: 74, name: 'Capinuri', emoji: '🌳', growTime: 205, value: 102, xp: 41, level: 5},
  {id: 75, name: 'Caraway', emoji: '🌾', growTime: 70, value: 30, xp: 12, level: 5},
  {id: 76, name: 'Cardamom', emoji: '🟢', growTime: 125, value: 56, xp: 22, level: 6},
  {id: 77, name: 'Carifillo', emoji: '🌿', growTime: 115, value: 52, xp: 21, level: 6},
  {id: 78, name: 'Carob', emoji: '🟤', growTime: 140, value: 63, xp: 25, level: 6},
  {id: 79, name: 'Carrot', emoji: '🥕', growTime: 65, value: 28, xp: 11, level: 6},
  {id: 80, name: 'Cascara Sagrada', emoji: '🌳', growTime: 160, value: 72, xp: 29, level: 6},
  {id: 81, name: 'Cats Claw', emoji: '🐱', growTime: 175, value: 88, xp: 35, level: 6},
  {id: 82, name: 'Catnip', emoji: '🐱', growTime: 55, value: 24, xp: 10, level: 6},
  {id: 83, name: 'Cattail', emoji: '🌾', growTime: 80, value: 35, xp: 14, level: 6},
  {id: 84, name: 'Catuaba', emoji: '🌳', growTime: 190, value: 95, xp: 38, level: 6},
  {id: 85, name: 'Cayenne', emoji: '🌶️', growTime: 75, value: 33, xp: 13, level: 6},
  {id: 86, name: 'Cedro', emoji: '🌲', growTime: 180, value: 90, xp: 36, level: 6},
  {id: 87, name: 'Celery', emoji: '🥬', growTime: 70, value: 30, xp: 12, level: 6},
  {id: 88, name: 'Cetico', emoji: '🌳', growTime: 165, value: 82, xp: 33, level: 6},
  {id: 89, name: 'Chacruna', emoji: '🌿', growTime: 250, value: 160, xp: 64, level: 6},
  {id: 90, name: 'Chaga Mushroom', emoji: '🍄', growTime: 280, value: 180, xp: 72, level: 6},
  {id: 91, name: 'Chaliponga', emoji: '🌿', growTime: 260, value: 165, xp: 66, level: 7},
  {id: 92, name: 'Chaparral', emoji: '🌵', growTime: 110, value: 50, xp: 20, level: 7},
  {id: 93, name: 'Cherry', emoji: '🍒', growTime: 85, value: 38, xp: 15, level: 7},
  {id: 94, name: 'Chervil', emoji: '🌿', growTime: 60, value: 26, xp: 11, level: 7},
  {id: 95, name: 'Chia', emoji: '⚪', growTime: 90, value: 40, xp: 16, level: 7},
  {id: 96, name: 'Chickweed', emoji: '🌱', growTime: 50, value: 22, xp: 9, level: 7},
  {id: 97, name: 'Chicory', emoji: '💙', growTime: 95, value: 42, xp: 17, level: 7},
  {id: 98, name: 'Chinese Yam', emoji: '🥔', growTime: 145, value: 65, xp: 26, level: 7},
  {id: 99, name: 'Chondrus Crispus', emoji: '🌊', growTime: 175, value: 88, xp: 35, level: 7},
  {id: 100, name: 'Chuchuhuasi', emoji: '🌳', growTime: 210, value: 115, xp: 46, level: 7},
  {id: 101, name: 'Cilantro', emoji: '🌿', growTime: 55, value: 24, xp: 10, level: 7},
  {id: 102, name: 'Cinnamon', emoji: '🟤', growTime: 135, value: 60, xp: 24, level: 7},
  {id: 103, name: 'Citronella', emoji: '🌿', growTime: 85, value: 38, xp: 15, level: 7},
  {id: 104, name: 'Cleavers', emoji: '🌱', growTime: 65, value: 28, xp: 11, level: 7},
  {id: 105, name: 'Clove', emoji: '🟤', growTime: 145, value: 65, xp: 26, level: 7},
  {id: 106, name: 'Codonopsis', emoji: '🌿', growTime: 165, value: 82, xp: 33, level: 8},
  {id: 107, name: 'Coltsfoot', emoji: '🌻', growTime: 75, value: 33, xp: 13, level: 8},
  {id: 108, name: 'Comfrey', emoji: '🌿', growTime: 95, value: 42, xp: 17, level: 8},
  {id: 109, name: 'Copaiba', emoji: '🌳', growTime: 195, value: 98, xp: 39, level: 8},
  {id: 110, name: 'Copal', emoji: '🟤', growTime: 155, value: 70, xp: 28, level: 8},
  {id: 111, name: 'Coriander', emoji: '🌾', growTime: 60, value: 26, xp: 11, level: 8},
  {id: 112, name: 'Corn Silk', emoji: '🌽', growTime: 70, value: 30, xp: 12, level: 8},
  {id: 113, name: 'Cramp Bark', emoji: '🌳', growTime: 120, value: 54, xp: 22, level: 8},
  {id: 114, name: 'Cranberry', emoji: '🔴', growTime: 100, value: 45, xp: 18, level: 8},
  {id: 115, name: 'Cumin', emoji: '🟤', growTime: 75, value: 33, xp: 13, level: 8},
  {id: 116, name: 'Damiana', emoji: '🌿', growTime: 125, value: 56, xp: 22, level: 8},
  {id: 117, name: 'Dandelion', emoji: '🌻', growTime: 45, value: 20, xp: 8, level: 8},
  {id: 118, name: 'Devils Claw', emoji: '🔴', growTime: 140, value: 63, xp: 25, level: 8},
  {id: 119, name: 'Dill', emoji: '🌿', growTime: 55, value: 24, xp: 10, level: 8},
  {id: 120, name: 'Dong Quai', emoji: '🌿', growTime: 170, value: 85, xp: 34, level: 8},
  {id: 121, name: 'Dragons Blood', emoji: '🐉', growTime: 230, value: 140, xp: 56, level: 9},
  {id: 122, name: 'Dulse', emoji: '🌊', growTime: 160, value: 80, xp: 32, level: 9},
  {id: 123, name: 'Echinacea', emoji: '🌸', growTime: 115, value: 52, xp: 21, level: 9},
  {id: 124, name: 'Elder Berries', emoji: '🫐', growTime: 105, value: 47, xp: 19, level: 9},
  {id: 125, name: 'Elder Flowers', emoji: '🌼', growTime: 95, value: 42, xp: 17, level: 9},
  {id: 126, name: 'Elecampane', emoji: '🌻', growTime: 130, value: 58, xp: 23, level: 9},
  {id: 127, name: 'Eleuthero', emoji: '🌿', growTime: 185, value: 92, xp: 37, level: 9},
  {id: 128, name: 'Epazote', emoji: '🌿', growTime: 65, value: 28, xp: 11, level: 9},
  {id: 129, name: 'Eucalyptus', emoji: '🌿', growTime: 110, value: 50, xp: 20, level: 9},
  {id: 130, name: 'Eyebright', emoji: '👁️', growTime: 85, value: 38, xp: 15, level: 9},
  {id: 131, name: 'False Unicorn', emoji: '🦄', growTime: 200, value: 110, xp: 44, level: 9},
  {id: 132, name: 'Fennel', emoji: '🌿', growTime: 70, value: 30, xp: 12, level: 9},
  {id: 133, name: 'Fenugreek', emoji: '🌾', growTime: 80, value: 35, xp: 14, level: 9},
  {id: 134, name: 'Feverfew', emoji: '🌼', growTime: 90, value: 40, xp: 16, level: 9},
  {id: 135, name: 'Fig', emoji: '🟣', growTime: 125, value: 56, xp: 22, level: 9},
  {id: 136, name: 'Flax', emoji: '🌾', growTime: 75, value: 33, xp: 13, level: 10},
  {id: 137, name: 'Fo-Ti', emoji: '🌿', growTime: 195, value: 98, xp: 39, level: 10},
  {id: 138, name: 'Frankincense', emoji: '🟤', growTime: 215, value: 120, xp: 48, level: 10},
  {id: 139, name: 'Galangal', emoji: '🫚', growTime: 105, value: 47, xp: 19, level: 10},
  {id: 140, name: 'Garcinia Cambogia', emoji: '🟢', growTime: 155, value: 70, xp: 28, level: 10},
  {id: 141, name: 'Garlic', emoji: '🧄', growTime: 85, value: 38, xp: 15, level: 10},
  {id: 142, name: 'Gentian', emoji: '💜', growTime: 140, value: 63, xp: 25, level: 10},
  {id: 143, name: 'Geranium', emoji: '🌺', growTime: 95, value: 42, xp: 17, level: 10},
  {id: 144, name: 'Ginger', emoji: '🫚', growTime: 100, value: 45, xp: 18, level: 10},
  {id: 145, name: 'Ginkgo', emoji: '🍃', growTime: 180, value: 90, xp: 36, level: 10},
  {id: 146, name: 'Ginseng', emoji: '🌿', growTime: 250, value: 160, xp: 64, level: 10},
  {id: 147, name: 'Glucomannan', emoji: '⚪', growTime: 120, value: 54, xp: 22, level: 10},
  {id: 148, name: 'Goats Rue', emoji: '🐐', growTime: 85, value: 38, xp: 15, level: 10},
  {id: 149, name: 'Goji Berry', emoji: '🔴', growTime: 135, value: 60, xp: 24, level: 10},
  {id: 150, name: 'Goldenseal', emoji: '💛', growTime: 190, value: 95, xp: 38, level: 10},
  {id: 151, name: 'Gotu Kola', emoji: '🌿', growTime: 110, value: 50, xp: 20, level: 11},
  {id: 152, name: 'Gravel Root', emoji: '🌿', growTime: 125, value: 56, xp: 22, level: 11},
  {id: 153, name: 'Green Tea', emoji: '🍵', growTime: 90, value: 40, xp: 16, level: 11},
  {id: 154, name: 'Griffonia', emoji: '🌿', growTime: 165, value: 82, xp: 33, level: 11},
  {id: 155, name: 'Grindelia', emoji: '🌻', growTime: 95, value: 42, xp: 17, level: 11},
  {id: 156, name: 'Guarana', emoji: '🔴', growTime: 145, value: 65, xp: 26, level: 11},
  {id: 157, name: 'Guayusa', emoji: '🍃', growTime: 130, value: 58, xp: 23, level: 11},
  {id: 158, name: 'Guduchi', emoji: '🌿', growTime: 155, value: 70, xp: 28, level: 11},
  {id: 159, name: 'Gymnema', emoji: '🌿', growTime: 140, value: 63, xp: 25, level: 11},
  {id: 160, name: 'Haritaki', emoji: '🟤', growTime: 170, value: 85, xp: 34, level: 11},
  {id: 161, name: 'Hawthorn Berry', emoji: '🔴', growTime: 115, value: 52, xp: 21, level: 11},
  {id: 162, name: 'Hawthorn Leaf', emoji: '🍃', growTime: 105, value: 47, xp: 19, level: 11},
  {id: 163, name: 'Henna', emoji: '🟠', growTime: 125, value: 56, xp: 22, level: 11},
  {id: 164, name: 'Hibiscus', emoji: '🌺', growTime: 85, value: 38, xp: 15, level: 11},
  {id: 165, name: 'Holy Basil', emoji: '🌿', growTime: 95, value: 42, xp: 17, level: 11},
  {id: 166, name: 'Hops', emoji: '🌿', growTime: 110, value: 50, xp: 20, level: 12},
  {id: 167, name: 'Horehound', emoji: '🌿', growTime: 75, value: 33, xp: 13, level: 12},
  {id: 168, name: 'Horse Chestnut', emoji: '🌰', growTime: 150, value: 68, xp: 27, level: 12},
  {id: 169, name: 'Horsetail', emoji: '🌿', growTime: 80, value: 35, xp: 14, level: 12},
  {id: 170, name: 'Huamanpinta', emoji: '🌿', growTime: 185, value: 92, xp: 37, level: 12},
  {id: 171, name: 'Huckleberry', emoji: '🫐', growTime: 100, value: 45, xp: 18, level: 12},
  {id: 172, name: 'Hydrangea', emoji: '💙', growTime: 120, value: 54, xp: 22, level: 12},
  {id: 173, name: 'Hyssop', emoji: '💜', growTime: 85, value: 38, xp: 15, level: 12},
  {id: 174, name: 'Iceland Moss', emoji: '🌿', growTime: 165, value: 82, xp: 33, level: 12},
  {id: 175, name: 'Indian Gooseberry', emoji: '🟢', growTime: 135, value: 60, xp: 24, level: 12},
  {id: 176, name: 'Ipecac', emoji: '🌿', growTime: 145, value: 65, xp: 26, level: 12},
  {id: 177, name: 'Irish Moss', emoji: '🌊', growTime: 160, value: 80, xp: 32, level: 12},
  {id: 178, name: 'Isatis', emoji: '💙', growTime: 125, value: 56, xp: 22, level: 12},
  {id: 179, name: 'Jaborandi', emoji: '🌿', growTime: 175, value: 88, xp: 35, level: 12},
  {id: 180, name: 'Jamaican Dogwood', emoji: '🌳', growTime: 195, value: 98, xp: 39, level: 12},
  {id: 181, name: 'Jasmine', emoji: '⚪', growTime: 95, value: 42, xp: 17, level: 13},
  {id: 182, name: 'Jatoba', emoji: '🌳', growTime: 210, value: 115, xp: 46, level: 13},
  {id: 183, name: 'Jiaogulan', emoji: '🌿', growTime: 140, value: 63, xp: 25, level: 13},
  {id: 184, name: 'Juniper Berry', emoji: '💙', growTime: 115, value: 52, xp: 21, level: 13},
  {id: 185, name: 'Kanna', emoji: '🌿', growTime: 155, value: 70, xp: 28, level: 13},
  {id: 186, name: 'Kava Kava', emoji: '🌿', growTime: 190, value: 95, xp: 38, level: 13},
  {id: 187, name: 'Kelp', emoji: '🌊', growTime: 150, value: 68, xp: 27, level: 13},
  {id: 188, name: 'Khella', emoji: '⚪', growTime: 105, value: 47, xp: 19, level: 13},
  {id: 189, name: 'Kigelia', emoji: '🌳', growTime: 200, value: 110, xp: 44, level: 13},
  {id: 190, name: 'Kola Nut', emoji: '🌰', growTime: 145, value: 65, xp: 26, level: 13},
  {id: 191, name: 'Kratom', emoji: '🌿', growTime: 220, value: 130, xp: 52, level: 13},
  {id: 192, name: 'Kudzu', emoji: '🌿', growTime: 95, value: 42, xp: 17, level: 13},
  {id: 193, name: 'Lady Slipper', emoji: '🌸', growTime: 185, value: 92, xp: 37, level: 13},
  {id: 194, name: 'Lavender', emoji: '💜', growTime: 100, value: 45, xp: 18, level: 13},
  {id: 195, name: 'Lemon Balm', emoji: '🍋', growTime: 70, value: 30, xp: 12, level: 13},
  {id: 196, name: 'Lemongrass', emoji: '🌾', growTime: 75, value: 33, xp: 13, level: 14},
  {id: 197, name: 'Licorice', emoji: '⚫', growTime: 160, value: 80, xp: 32, level: 14},
  {id: 198, name: 'Lions Mane', emoji: '🦁', growTime: 240, value: 150, xp: 60, level: 14},
  {id: 199, name: 'Lobelia', emoji: '💙', growTime: 90, value: 40, xp: 16, level: 14},
  {id: 200, name: 'Lomatium', emoji: '🌿', growTime: 135, value: 60, xp: 24, level: 14},
  {id: 201, name: 'Lotus', emoji: '🪷', growTime: 175, value: 88, xp: 35, level: 14},
  {id: 202, name: 'Lovage', emoji: '🌿', growTime: 85, value: 38, xp: 15, level: 14},
  {id: 203, name: 'Lungwort', emoji: '🌿', growTime: 110, value: 50, xp: 20, level: 14},
  {id: 204, name: 'Lycium', emoji: '🔴', growTime: 125, value: 56, xp: 22, level: 14},
  {id: 205, name: 'Maca', emoji: '🌰', growTime: 180, value: 90, xp: 36, level: 14},
  {id: 206, name: 'Magnolia Bark', emoji: '🌳', growTime: 165, value: 82, xp: 33, level: 14},
  {id: 207, name: 'Maitake', emoji: '🍄', growTime: 230, value: 140, xp: 56, level: 14},
  {id: 208, name: 'Mallow', emoji: '🌸', growTime: 80, value: 35, xp: 14, level: 14},
  {id: 209, name: 'Mandrake', emoji: '🌿', growTime: 280, value: 180, xp: 72, level: 14},
  {id: 210, name: 'Mangosteen', emoji: '🟣', growTime: 155, value: 70, xp: 28, level: 14},
  {id: 211, name: 'Manjistha', emoji: '🔴', growTime: 145, value: 65, xp: 26, level: 15},
  {id: 212, name: 'Marigold', emoji: '🟠', growTime: 65, value: 28, xp: 11, level: 15},
  {id: 213, name: 'Marjoram', emoji: '🌿', growTime: 70, value: 30, xp: 12, level: 15},
  {id: 214, name: 'Marshmallow', emoji: '⚪', growTime: 95, value: 42, xp: 17, level: 15},
  {id: 215, name: 'Mashua', emoji: '🟣', growTime: 120, value: 54, xp: 22, level: 15},
  {id: 216, name: 'Mastic Gum', emoji: '⚪', growTime: 170, value: 85, xp: 34, level: 15},
  {id: 217, name: 'Meadowsweet', emoji: '🌼', growTime: 85, value: 38, xp: 15, level: 15},
  {id: 218, name: 'Milk Thistle', emoji: '🌿', growTime: 115, value: 52, xp: 21, level: 15},
  {id: 219, name: 'Mimosa', emoji: '🌸', growTime: 190, value: 95, xp: 38, level: 15},
  {id: 220, name: 'Mistletoe', emoji: '🌿', growTime: 140, value: 63, xp: 25, level: 15},
  {id: 221, name: 'Moringa', emoji: '🌿', growTime: 130, value: 58, xp: 23, level: 15},
  {id: 222, name: 'Motherwort', emoji: '🌿', growTime: 90, value: 40, xp: 16, level: 15},
  {id: 223, name: 'Muira Puama', emoji: '🌳', growTime: 200, value: 110, xp: 44, level: 15},
  {id: 224, name: 'Mulberry', emoji: '🫐', growTime: 105, value: 47, xp: 19, level: 15},
  {id: 225, name: 'Mullein', emoji: '🌿', growTime: 75, value: 33, xp: 13, level: 15},
  {id: 226, name: 'Mustard', emoji: '🟡', growTime: 60, value: 26, xp: 11, level: 16},
  {id: 227, name: 'Myrrh', emoji: '🟤', growTime: 215, value: 120, xp: 48, level: 16},
  {id: 228, name: 'Myrtle', emoji: '🌿', growTime: 100, value: 45, xp: 18, level: 16},
  {id: 229, name: 'Neem', emoji: '🌿', growTime: 150, value: 68, xp: 27, level: 16},
  {id: 230, name: 'Nettle', emoji: '🌿', growTime: 55, value: 24, xp: 10, level: 16},
  {id: 231, name: 'Noni', emoji: '⚪', growTime: 160, value: 80, xp: 32, level: 16},
  {id: 232, name: 'Nutmeg', emoji: '🟤', growTime: 135, value: 60, xp: 24, level: 16},
  {id: 233, name: 'Oak Bark', emoji: '🌳', growTime: 125, value: 56, xp: 22, level: 16},
  {id: 234, name: 'Oat Straw', emoji: '🌾', growTime: 65, value: 28, xp: 11, level: 16},
  {id: 235, name: 'Olive Leaf', emoji: '🍃', growTime: 110, value: 50, xp: 20, level: 16},
  {id: 236, name: 'Oolong Tea', emoji: '🍵', growTime: 95, value: 42, xp: 17, level: 16},
  {id: 237, name: 'Orange Peel', emoji: '🟠', growTime: 70, value: 30, xp: 12, level: 16},
  {id: 238, name: 'Oregano', emoji: '🌿', growTime: 60, value: 26, xp: 11, level: 16},
  {id: 239, name: 'Oregon Grape', emoji: '🍇', growTime: 145, value: 65, xp: 26, level: 16},
  {id: 240, name: 'Osha', emoji: '🌿', growTime: 185, value: 92, xp: 37, level: 16},
  {id: 241, name: 'Papaya Leaf', emoji: '🍃', growTime: 80, value: 35, xp: 14, level: 17},
  {id: 242, name: 'Parsley', emoji: '🌿', growTime: 50, value: 22, xp: 9, level: 17},
  {id: 243, name: 'Partridge Berry', emoji: '🔴', growTime: 115, value: 52, xp: 21, level: 17},
  {id: 244, name: 'Passion Flower', emoji: '🌺', growTime: 130, value: 58, xp: 23, level: 17},
  {id: 245, name: 'Pau d Arco', emoji: '🌳', growTime: 195, value: 98, xp: 39, level: 17},
  {id: 246, name: 'Pennyroyal', emoji: '💜', growTime: 75, value: 33, xp: 13, level: 17},
  {id: 247, name: 'Peony', emoji: '🌸', growTime: 155, value: 70, xp: 28, level: 17},
  {id: 248, name: 'Peppermint', emoji: '🌿', growTime: 55, value: 24, xp: 10, level: 17},
  {id: 249, name: 'Periwinkle', emoji: '💜', growTime: 90, value: 40, xp: 16, level: 17},
  {id: 250, name: 'Pine Bark', emoji: '🌲', growTime: 140, value: 63, xp: 25, level: 17},
  {id: 251, name: 'Pine Needle', emoji: '🌲', growTime: 70, value: 30, xp: 12, level: 17},
  {id: 252, name: 'Pipsissewa', emoji: '🌿', growTime: 105, value: 47, xp: 19, level: 17},
  {id: 253, name: 'Plantain', emoji: '🌿', growTime: 45, value: 20, xp: 8, level: 17},
  {id: 254, name: 'Pleurisy Root', emoji: '🟠', growTime: 135, value: 60, xp: 24, level: 17},
  {id: 255, name: 'Poke Root', emoji: '🌿', growTime: 120, value: 54, xp: 22, level: 17},
  {id: 256, name: 'Pomegranate', emoji: '🔴', growTime: 145, value: 65, xp: 26, level: 18},
  {id: 257, name: 'Poppy Seed', emoji: '⚫', growTime: 85, value: 38, xp: 15, level: 18},
  {id: 258, name: 'Prickly Ash', emoji: '🌳', growTime: 160, value: 80, xp: 32, level: 18},
  {id: 259, name: 'Psyllium', emoji: '🌾', growTime: 75, value: 33, xp: 13, level: 18},
  {id: 260, name: 'Pu-erh Tea', emoji: '🍵', growTime: 110, value: 50, xp: 20, level: 18},
  {id: 261, name: 'Pulsatilla', emoji: '💜', growTime: 100, value: 45, xp: 18, level: 18},
  {id: 262, name: 'Pumpkin Seed', emoji: '🎃', growTime: 65, value: 28, xp: 11, level: 18},
  {id: 263, name: 'Purslane', emoji: '🌿', growTime: 40, value: 18, xp: 7, level: 18},
  {id: 264, name: 'Pygeum', emoji: '🌳', growTime: 190, value: 95, xp: 38, level: 18},
  {id: 265, name: 'Quassia', emoji: '🌳', growTime: 170, value: 85, xp: 34, level: 18},
  {id: 266, name: 'Queen of the Meadow', emoji: '👑', growTime: 125, value: 56, xp: 22, level: 18},
  {id: 267, name: 'Quince', emoji: '🟡', growTime: 115, value: 52, xp: 21, level: 18},
  {id: 268, name: 'Raspberry Leaf', emoji: '🍃', growTime: 70, value: 30, xp: 12, level: 18},
  {id: 269, name: 'Red Clover', emoji: '🌸', growTime: 85, value: 38, xp: 15, level: 18},
  {id: 270, name: 'Red Root', emoji: '🔴', growTime: 140, value: 63, xp: 25, level: 18},
  {id: 271, name: 'Red Sage', emoji: '🔴', growTime: 95, value: 42, xp: 17, level: 19},
  {id: 272, name: 'Rehmannia', emoji: '🌿', growTime: 165, value: 82, xp: 33, level: 19},
  {id: 273, name: 'Reishi', emoji: '🍄', growTime: 260, value: 165, xp: 66, level: 19},
  {id: 274, name: 'Rhodiola', emoji: '🌸', growTime: 200, value: 110, xp: 44, level: 19},
  {id: 275, name: 'Rhubarb', emoji: '🔴', growTime: 105, value: 47, xp: 19, level: 19},
  {id: 276, name: 'Rooibos', emoji: '🔴', growTime: 90, value: 40, xp: 16, level: 19},
  {id: 277, name: 'Rose Hips', emoji: '🌹', growTime: 80, value: 35, xp: 14, level: 19},
  {id: 278, name: 'Rosemary', emoji: '🌿', growTime: 75, value: 33, xp: 13, level: 19},
  {id: 279, name: 'Rue', emoji: '🌿', growTime: 85, value: 38, xp: 15, level: 19},
  {id: 280, name: 'Saffron', emoji: '🟠', growTime: 300, value: 200, xp: 80, level: 19},
  {id: 281, name: 'Sage', emoji: '🌿', growTime: 65, value: 28, xp: 11, level: 19},
  {id: 282, name: 'Salvia', emoji: '💜', growTime: 185, value: 92, xp: 37, level: 19},
  {id: 283, name: 'Sandalwood', emoji: '🌳', growTime: 225, value: 135, xp: 54, level: 19},
  {id: 284, name: 'Sangre de Grado', emoji: '🔴', growTime: 210, value: 115, xp: 46, level: 19},
  {id: 285, name: 'Sarsaparilla', emoji: '🌿', growTime: 150, value: 68, xp: 27, level: 19},
  {id: 286, name: 'Sassafras', emoji: '🌳', growTime: 135, value: 60, xp: 24, level: 20},
  {id: 287, name: 'Saw Palmetto', emoji: '🌴', growTime: 175, value: 88, xp: 35, level: 20},
  {id: 288, name: 'Schisandra', emoji: '🔴', growTime: 160, value: 80, xp: 32, level: 20},
  {id: 289, name: 'Scullcap', emoji: '💙', growTime: 95, value: 42, xp: 17, level: 20},
  {id: 290, name: 'Sea Buckthorn', emoji: '🟠', growTime: 145, value: 65, xp: 26, level: 20},
  {id: 291, name: 'Senna', emoji: '🟡', growTime: 80, value: 35, xp: 14, level: 20},
  {id: 292, name: 'Sheep Sorrel', emoji: '🌿', growTime: 50, value: 22, xp: 9, level: 20},
  {id: 293, name: 'Shepherds Purse', emoji: '⚪', growTime: 60, value: 26, xp: 11, level: 20},
  {id: 294, name: 'Shiitake', emoji: '🍄', growTime: 220, value: 130, xp: 52, level: 20},
  {id: 295, name: 'Shilajit', emoji: '⚫', growTime: 280, value: 180, xp: 72, level: 20},
  {id: 296, name: 'Siberian Ginseng', emoji: '🌿', growTime: 195, value: 98, xp: 39, level: 20},
  {id: 297, name: 'Slippery Elm', emoji: '🌳', growTime: 120, value: 54, xp: 22, level: 20},
  {id: 298, name: 'Soapwort', emoji: '⚪', growTime: 75, value: 33, xp: 13, level: 20},
  {id: 299, name: 'Soursop', emoji: '🟢', growTime: 155, value: 70, xp: 28, level: 20},
  {id: 300, name: 'Spearmint', emoji: '🌿', growTime: 55, value: 24, xp: 10, level: 20},
  {id: 301, name: 'Spikenard', emoji: '🌿', growTime: 165, value: 82, xp: 33, level: 21},
  {id: 302, name: 'Spirulina', emoji: '🟢', growTime: 140, value: 63, xp: 25, level: 21},
  {id: 303, name: 'St Johns Wort', emoji: '🟡', growTime: 100, value: 45, xp: 18, level: 21},
  {id: 304, name: 'Star Anise', emoji: '⭐', growTime: 110, value: 50, xp: 20, level: 21},
  {id: 305, name: 'Stevia', emoji: '🌿', growTime: 85, value: 38, xp: 15, level: 21},
  {id: 306, name: 'Stinging Nettle', emoji: '🌿', growTime: 60, value: 26, xp: 11, level: 21},
  {id: 307, name: 'Stone Root', emoji: '🪨', growTime: 130, value: 58, xp: 23, level: 21},
  {id: 308, name: 'Suma', emoji: '🌿', growTime: 180, value: 90, xp: 36, level: 21},
  {id: 309, name: 'Sumac', emoji: '🔴', growTime: 90, value: 40, xp: 16, level: 21},
  {id: 310, name: 'Sundew', emoji: '💧', growTime: 145, value: 65, xp: 26, level: 21},
  {id: 311, name: 'Taheebo', emoji: '🌳', growTime: 200, value: 110, xp: 44, level: 21},
  {id: 312, name: 'Tamarind', emoji: '🟤', growTime: 125, value: 56, xp: 22, level: 21},
  {id: 313, name: 'Tansy', emoji: '🟡', growTime: 75, value: 33, xp: 13, level: 21},
  {id: 314, name: 'Tea Tree', emoji: '🌿', growTime: 115, value: 52, xp: 21, level: 21},
  {id: 315, name: 'Terminalia', emoji: '🌳', growTime: 170, value: 85, xp: 34, level: 21},
  {id: 316, name: 'Thyme', emoji: '🌿', growTime: 55, value: 24, xp: 10, level: 22},
  {id: 317, name: 'Tienchi Ginseng', emoji: '🌿', growTime: 235, value: 145, xp: 58, level: 22},
  {id: 318, name: 'Tonka Bean', emoji: '🟤', growTime: 155, value: 70, xp: 28, level: 22},
  {id: 319, name: 'Tormentil', emoji: '🟡', growTime: 95, value: 42, xp: 17, level: 22},
  {id: 320, name: 'Tribulus', emoji: '🌿', growTime: 105, value: 47, xp: 19, level: 22},
  {id: 321, name: 'Triphala', emoji: '🟤', growTime: 185, value: 92, xp: 37, level: 22},
  {id: 322, name: 'Tsuga', emoji: '🌲', growTime: 140, value: 63, xp: 25, level: 22},
  {id: 323, name: 'Turmeric', emoji: '🟡', growTime: 120, value: 54, xp: 22, level: 22},
  {id: 324, name: 'Turkey Tail', emoji: '🦃', growTime: 210, value: 115, xp: 46, level: 22},
  {id: 325, name: 'Tylophora', emoji: '🌿', growTime: 130, value: 58, xp: 23, level: 22},
  {id: 326, name: 'Uña de Gato', emoji: '🐱', growTime: 175, value: 88, xp: 35, level: 22},
  {id: 327, name: 'Usnea', emoji: '🌿', growTime: 160, value: 80, xp: 32, level: 22},
  {id: 328, name: 'Uva Ursi', emoji: '🍇', growTime: 110, value: 50, xp: 20, level: 22},
  {id: 329, name: 'Valerian', emoji: '🌿', growTime: 125, value: 56, xp: 22, level: 22},
  {id: 330, name: 'Vanilla', emoji: '🤍', growTime: 195, value: 98, xp: 39, level: 22},
  {id: 331, name: 'Vervain', emoji: '💜', growTime: 85, value: 38, xp: 15, level: 23},
  {id: 332, name: 'Vetiver', emoji: '🌾', growTime: 150, value: 68, xp: 27, level: 23},
  {id: 333, name: 'Violet', emoji: '💜', growTime: 70, value: 30, xp: 12, level: 23},
  {id: 334, name: 'Vitex', emoji: '💜', growTime: 135, value: 60, xp: 24, level: 23},
  {id: 335, name: 'Wahoo', emoji: '🌳', growTime: 145, value: 65, xp: 26, level: 23},
  {id: 336, name: 'Walnut', emoji: '🌰', growTime: 165, value: 82, xp: 33, level: 23},
  {id: 337, name: 'Wasabi', emoji: '🟢', growTime: 100, value: 45, xp: 18, level: 23},
  {id: 338, name: 'Watercress', emoji: '🌿', growTime: 45, value: 20, xp: 8, level: 23},
  {id: 339, name: 'Weld', emoji: '🟡', growTime: 80, value: 35, xp: 14, level: 23},
  {id: 340, name: 'Wheat Grass', emoji: '🌾', growTime: 50, value: 22, xp: 9, level: 23},
  {id: 341, name: 'White Oak', emoji: '🌳', growTime: 180, value: 90, xp: 36, level: 23},
  {id: 342, name: 'White Pine', emoji: '🌲', growTime: 155, value: 70, xp: 28, level: 23},
  {id: 343, name: 'White Willow', emoji: '🌳', growTime: 115, value: 52, xp: 21, level: 23},
  {id: 344, name: 'Wild Cherry', emoji: '🍒', growTime: 95, value: 42, xp: 17, level: 23},
  {id: 345, name: 'Wild Ginger', emoji: '🫚', growTime: 105, value: 47, xp: 19, level: 23},
  {id: 346, name: 'Wild Indigo', emoji: '💙', growTime: 140, value: 63, xp: 25, level: 24},
  {id: 347, name: 'Wild Lettuce', emoji: '🥬', growTime: 60, value: 26, xp: 11, level: 24},
  {id: 348, name: 'Wild Yam', emoji: '🥔', growTime: 130, value: 58, xp: 23, level: 24},
  {id: 349, name: 'Wintergreen', emoji: '🌿', growTime: 90, value: 40, xp: 16, level: 24},
  {id: 350, name: 'Witch Hazel', emoji: '🌿', growTime: 110, value: 50, xp: 20, level: 24},
  {id: 351, name: 'Woad', emoji: '💙', growTime: 125, value: 56, xp: 22, level: 24},
  {id: 352, name: 'Wood Betony', emoji: '💜', growTime: 85, value: 38, xp: 15, level: 24},
  {id: 353, name: 'Wormwood', emoji: '🌿', growTime: 100, value: 45, xp: 18, level: 24},
  {id: 354, name: 'Xanthium', emoji: '🌿', growTime: 95, value: 42, xp: 17, level: 24},
  {id: 355, name: 'Xhoba', emoji: '🌿', growTime: 185, value: 92, xp: 37, level: 24},
  {id: 356, name: 'Yacon', emoji: '🥔', growTime: 145, value: 65, xp: 26, level: 24},
  {id: 357, name: 'Yarrow', emoji: '⚪', growTime: 75, value: 33, xp: 13, level: 24},
  {id: 358, name: 'Yellow Dock', emoji: '🟡', growTime: 105, value: 47, xp: 19, level: 24},
  {id: 359, name: 'Yerba Mate', emoji: '🍃', growTime: 135, value: 60, xp: 24, level: 24},
  {id: 360, name: 'Yerba Santa', emoji: '🌿', growTime: 120, value: 54, xp: 22, level: 24},
  {id: 361, name: 'Ylang Ylang', emoji: '🌼', growTime: 160, value: 80, xp: 32, level: 25},
  {id: 362, name: 'Yohimbe', emoji: '🌳', growTime: 220, value: 130, xp: 52, level: 25},
  {id: 363, name: 'Yopo', emoji: '🌿', growTime: 245, value: 155, xp: 62, level: 25},
  {id: 364, name: 'Yucca', emoji: '🌵', growTime: 125, value: 56, xp: 22, level: 25},
  {id: 365, name: 'Zanthoxylum', emoji: '🌿', growTime: 140, value: 63, xp: 25, level: 25},
  {id: 366, name: 'Zedoary', emoji: '🟡', growTime: 115, value: 52, xp: 21, level: 25},
  {id: 367, name: 'Zeolite', emoji: '⚪', growTime: 200, value: 110, xp: 44, level: 25},
  {id: 368, name: 'Zhi Mu', emoji: '🌿', growTime: 155, value: 70, xp: 28, level: 25},
  {id: 369, name: 'Ziziphus', emoji: '🔴', growTime: 170, value: 85, xp: 34, level: 25}
],
            ],
            
            // Inventory
            inventory: {}
        };

        // Load saved game
        const saved = localStorage.getItem('canaGameState');
        if (saved) {
            gameState = {...gameState, ...JSON.parse(saved)};
        }

        // Initialize farm grid
        function initFarmGrid() {
            const grid = document.getElementById('farmGrid');
            grid.innerHTML = '';
            
            for (let i = 0; i < 64; i++) {
                const plot = document.createElement('div');
                plot.className = 'plot';
                plot.id = `plot-${i}`;
                plot.onclick = () => handlePlotClick(i);
                
                if (gameState.plots[i]) {
                    updatePlot(i, gameState.plots[i]);
                }
                
                grid.appendChild(plot);
            }
        }
       
plots: Array(16).fill(null), // Changed from 64 to 16 for mobile

        // Handle plot click
        function handlePlotClick(plotId) {
            const plot = gameState.plots[plotId];
            
            if (!plot) {
                // Empty plot - plant something
                plantCrop(plotId);
            } else if (plot.ready) {
                // Ready to harvest
                harvestCrop(plotId);
            } else {
                // Still growing - show info
                showPlotInfo(plotId);
            }
        }

        // Plant crop
        function plantCrop(plotId) {
            if (gameState.energy < 5) {
                showFloatingText('Need 5 energy!', event.clientX, event.clientY, '#ef4444');
                return;
            }
            
            // Quick plant menu
            const plant = gameState.plants[Math.floor(Math.random() * Math.min(gameState.level + 2, gameState.plants.length))];
            
            if (gameState.coins < plant.value) {
                showFloatingText('Not enough coins!', event.clientX, event.clientY, '#ef4444');
                return;
            }
            
            gameState.coins -= plant.value;
            gameState.energy -= 5;
            
            gameState.plots[plotId] = {
                plant: plant,
                plantedAt: Date.now(),
                growTime: plant.growTime * 1000,
                ready: false
            };
            
            updatePlot(plotId, gameState.plots[plotId]);
            updateUI();
            saveGame();
            
            // Schedule growth
            setTimeout(() => {
                if (gameState.plots[plotId]) {
                    gameState.plots[plotId].ready = true;
                    updatePlot(plotId, gameState.plots[plotId]);
                    showFloatingText('Ready!', 0, 0, '#4ade80');
                }
            }, plant.growTime * 1000);
        }

        // Update plot display
        function updatePlot(plotId, plotData) {
            const plotEl = document.getElementById(`plot-${plotId}`);
            if (!plotEl || !plotData) return;
            
            const now = Date.now();
            const timeLeft = (plotData.plantedAt + plotData.growTime) - now;
            const ready = timeLeft <= 0;
            
            plotEl.innerHTML = '';
            
            if (plotData.plant) {
                const plantEl = document.createElement('div');
                plantEl.className = 'plot-plant';
                plantEl.textContent = plotData.plant.emoji;
                plotEl.appendChild(plantEl);
                
                if (!ready) {
                    const timerEl = document.createElement('div');
                    timerEl.className = 'plot-timer';
                    timerEl.textContent = formatTime(Math.ceil(timeLeft / 1000));
                    plotEl.appendChild(timerEl);
                    
                    // Update timer
                    setTimeout(() => updatePlot(plotId, plotData), 1000);
                } else {
                    plotEl.classList.add('plot-ready');
                    plotData.ready = true;
                }
            }
        }

       // Enhanced harvest with inventory system
function harvestCrop(plotId) {
    const plot = gameState.plots[plotId];
    if (!plot || !plot.ready) return;
    
    const xpGain = plot.plant.xp;
    const quantity = 1 + Math.floor(Math.random() * 3); // 1-3 plants per harvest
    
    gameState.xp += xpGain;
    gameState.coopProgress += quantity;
    
    // Add to inventory
    if (!gameState.inventory[plot.plant.id]) {
        gameState.inventory[plot.plant.id] = {
            plant: plot.plant,
            quantity: 0
        };
    }
    gameState.inventory[plot.plant.id].quantity += quantity;
    
function openInventory() {
    const modal = document.getElementById('inventoryModal');
    if (!modal) {
        // Create inventory modal if it doesn't exist
        const modalHTML = `
            <div class="modal" id="inventoryModal">
                <div class="modal-content">
                    <div class="modal-header">
                        <span class="modal-title">📦 Your Inventory</span>
                        <button class="close-btn" onclick="closeModal('inventoryModal')">✖</button>
                    </div>
                    <div id="inventoryContent"></div>
                </div>
            </div>
        `;
        document.body.insertAdjacentHTML('beforeend', modalHTML);
    }
    
    const inventoryContent = document.getElementById('inventoryContent');
    const inventoryItems = Object.values(gameState.inventory).filter(item => item.quantity > 0);
    
    if (inventoryItems.length === 0) {
        inventoryContent.innerHTML = `
            <div style="text-align: center; padding: 40px; opacity: 0.6;">
                Your inventory is empty. Start harvesting plants!
            </div>
        `;
    } else {
        // Calculate total value
        const totalValue = inventoryItems.reduce((sum, item) => {
            return sum + (item.plant.value * 3 * item.quantity);
        }, 0);
        
        inventoryContent.innerHTML = `
            <div style="background: rgba(251, 191, 36, 0.1); border: 1px solid #fbbf24; padding: 10px; border-radius: 10px; margin-bottom: 15px;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span style="font-weight: bold;">Total Inventory Value:</span>
                    <span style="color: #fbbf24; font-size: 20px; font-weight: bold;">💰 ${totalValue}</span>
                </div>
                <button class="item-action" onclick="sellAllInventory()" style="width: 100%; margin-top: 10px;">
                    Sell Everything
                </button>
            </div>
            <div class="inventory-grid" style="max-height: 400px; overflow-y: auto;">
                ${inventoryItems.map(item => {
                    const sellPrice = item.plant.value * 3; // 3x buy price
                    const totalSellPrice = sellPrice * item.quantity;
                    return `
                        <div class="inventory-item" style="padding: 15px; background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3); border-radius: 10px; margin-bottom: 10px;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div style="flex: 1;">
                                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 5px;">
                                        <span style="font-size: 30px;">${item.plant.emoji}</span>
                                        <div>
                                            <div style="font-weight: bold; color: #4ade80;">${item.plant.name}</div>
                                            <div style="font-size: 12px; opacity: 0.8;">Quantity: ${item.quantity}</div>
                                        </div>
                                    </div>
                                    <div style="font-size: 11px; margin-top: 5px;">
                                        <span style="opacity: 0.7;">Price each:</span> 
                                        <span style="color: #fbbf24;">💰 ${sellPrice}</span>
                                    </div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="font-size: 14px; color: #fbbf24; font-weight: bold; margin-bottom: 5px;">
                                        💰 ${totalSellPrice}
                                    </div>
                                    <button class="action-btn" onclick="sellItem(${item.plant.id}, ${item.quantity})" style="padding: 8px 15px;">
                                        Sell
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('')}
            </div>
        `;
    }
    
    document.getElementById('inventoryModal').classList.add('active');
}
    // Sell specific item
function sellItem(plantId, maxQuantity) {
    const item = gameState.inventory[plantId];
    if (!item || item.quantity === 0) return;
    
    const sellPrice = item.plant.value * 3;
    let quantity = maxQuantity;
    
    if (maxQuantity > 1) {
        const input = prompt(`How many ${item.plant.name} to sell? (Max: ${maxQuantity})`, maxQuantity);
        if (!input) return;
        quantity = Math.min(parseInt(input) || 0, maxQuantity);
        if (quantity <= 0) return;
    }
    
    const totalEarnings = sellPrice * quantity;
    
    // Update inventory
    item.quantity -= quantity;
    if (item.quantity <= 0) {
        delete gameState.inventory[plantId];
    }
    
    // Add coins
    gameState.coins += totalEarnings;
    
    // Show feedback
    showFloatingText(`+💰 ${totalEarnings}`, window.innerWidth / 2, 200, '#fbbf24');
    
    // Update displays
    updateUI();
    saveGame();
    openInventory(); // Refresh inventory display
}

// Sell all inventory
function sellAllInventory() {
    const inventoryItems = Object.values(gameState.inventory).filter(item => item.quantity > 0);
    
    if (inventoryItems.length === 0) return;
    
    if (!confirm('Sell your entire inventory?')) return;
    
    let totalEarnings = 0;
    
    inventoryItems.forEach(item => {
        const sellPrice = item.plant.value * 3;
        totalEarnings += sellPrice * item.quantity;
    });
    
    // Clear inventory
    gameState.inventory = {};
    
    // Add coins
    gameState.coins += totalEarnings;
    
    // Show feedback
    showFloatingText(`+💰 ${totalEarnings}!`, window.innerWidth / 2, 200, '#fbbf24');
    
    // Update displays
    updateUI();
    saveGame();
    openInventory();
}
    
    // Clear plot
    gameState.plots[plotId] = null;
    document.getElementById(`plot-${plotId}`).className = 'plot';
    document.getElementById(`plot-${plotId}`).innerHTML = '';
    
    // Show rewards
    showFloatingText(`+${xpGain} XP`, event.clientX - 20, event.clientY, '#4ade80');
    showFloatingText(`+${quantity} ${plot.plant.emoji}`, event.clientX + 20, event.clientY, '#fbbf24');
    
    checkLevelUp();
    updateUI();
    saveGame();
    
    // Refresh inventory if it's open
    if (document.getElementById('inventoryModal') && document.getElementById('inventoryModal').classList.contains('active')) {
        openInventory();
    }
}
            gameState.plots[plotId] = null;
            document.getElementById(`plot-${plotId}`).className = 'plot';
            document.getElementById(`plot-${plotId}`).innerHTML = '';
            
            // Show rewards
            showFloatingText(`+${xpGain} XP`, event.clientX - 20, event.clientY, '#4ade80');
            showFloatingText(`+${herbsGain} ${plot.plant.emoji}`, event.clientX + 20, event.clientY, '#fbbf24');
            
            // Check level up
            checkLevelUp();
            
            // Check achievements
            if (gameState.herbs === 1) {
                showAchievement('First Harvest!');
            } else if (gameState.herbs === 100) {
                showAchievement('100 Herbs Collected!');
            }
            
            updateUI();
            saveGame();
        }

        // Check level up
        function checkLevelUp() {
            const xpNeeded = gameState.level * 100;
            if (gameState.xp >= xpNeeded) {
                gameState.level++;
                gameState.xp -= xpNeeded;
                gameState.maxEnergy += 10;
                gameState.energy = gameState.maxEnergy;
                
                showAchievement(`Level ${gameState.level}!`);
                
                // Unlock new content
                if (gameState.level === 5) {
                    gameState.buildings.apothecary.locked = false;
                    showAchievement('Apothecary Unlocked!');
                }
                if (gameState.level === 10) {
                    gameState.totalFarms = 2;
                    showAchievement('New Farm Unlocked!');
                }
            }
        }

        // Show floating text
        function showFloatingText(text, x, y, color = '#4ade80') {
            const el = document.createElement('div');
            el.className = 'floating-text';
            el.textContent = text;
            el.style.left = x + 'px';
            el.style.top = y + 'px';
            el.style.color = color;
            document.body.appendChild(el);
            
            setTimeout(() => el.remove(), 2000);
        }

        // Show achievement
        function showAchievement(text) {
            const toast = document.getElementById('achievementToast');
            document.getElementById('achievementDesc').textContent = text;
            toast.classList.add('show');
            
            if (tg) tg.HapticFeedback.notificationOccurred('success');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Format time
        function formatTime(seconds) {
            if (seconds < 60) return `${seconds}s`;
            if (seconds < 3600) return `${Math.floor(seconds / 60)}m`;
            return `${Math.floor(seconds / 3600)}h`;
        }

        function updateUI() {
    document.getElementById('playerLevel').textContent = gameState.level;
    document.getElementById('farmNumber').textContent = gameState.currentFarm;
    document.getElementById('playerXP').textContent = gameState.xp;
    document.getElementById('coins').textContent = gameState.coins;
    document.getElementById('gems').textContent = gameState.gems;
    
    // Calculate total herbs in inventory
    const totalHerbs = Object.values(gameState.inventory).reduce((sum, item) => sum + (item.quantity || 0), 0);
    document.getElementById('herbs').textContent = totalHerbs;
    
    document.getElementById('extracts').textContent = gameState.extracts;
    document.getElementById('energy').textContent = gameState.energy;
    document.getElementById('energyBar').style.width = (gameState.energy / gameState.maxEnergy * 100) + '%';
}

        // Save game
        function saveGame() {
            localStorage.setItem('canaGameState', JSON.stringify(gameState));
        }

        // Weather system
        function updateWeather() {
            const weathers = [
                {icon: '☀️', text: 'Sunny', bonus: 1.0},
                {icon: '⛅', text: 'Cloudy', bonus: 0.9},
                {icon: '🌧️', text: 'Rainy', bonus: 1.2},
                {icon: '⛈️', text: 'Stormy', bonus: 0.8},
                {icon: '🌈', text: 'Rainbow', bonus: 1.5}
            ];
            
            const weather = weathers[Math.floor(Math.random() * weathers.length)];
            gameState.weather = weather.text;
            gameState.weatherBonus = weather.bonus;
            
            document.getElementById('weatherIcon').textContent = weather.icon;
            document.getElementById('weatherText').textContent = weather.text;
            
            if (weather.bonus > 1) {
                showFloatingText(`Weather Bonus: ${Math.round((weather.bonus - 1) * 100)}%!`, window.innerWidth / 2, 100);
            }
        }

        // Energy regeneration
        setInterval(() => {
            if (gameState.energy < gameState.maxEnergy) {
                gameState.energy = Math.min(gameState.energy + 1, gameState.maxEnergy);
                updateUI();
            }
        }, 10000); // +1 energy every 10 seconds

        // Change weather every 5 minutes
        setInterval(updateWeather, 300000);

        // Modal controls
      function showView(view) {
    // Update nav
    document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
    event.target.closest('.nav-item').classList.add('active');
    
    // Show appropriate modal
    switch(view) {
        case 'market':
            openMarket();
            break;
        case 'social':
            openSocial();
            break;
        case 'inventory':
            openInventory(); // Now uses the new function
            break;
        case 'quests':
            showFloatingText('Quests coming soon!', window.innerWidth / 2, 200);
            break;
    }
}
        
function openMarket() {
    const modal = document.getElementById('marketModal');
    const grid = document.getElementById('marketGrid');
    
    // Generate all 369 plants with tiered stats
    const fullPlantList = generateFullPlantList();
    
    // Group plants by tier/level
    const tiers = {};
    fullPlantList.forEach(plant => {
        const tier = `Level ${plant.level}`;
        if (!tiers[tier]) tiers[tier] = [];
        tiers[tier].push(plant);
    });
    
    // Build the market HTML with tier sections
    let marketHTML = '<div style="max-height: 400px; overflow-y: auto;">';
    
    Object.keys(tiers).sort((a,b) => {
        const levelA = parseInt(a.replace('Level ', ''));
        const levelB = parseInt(b.replace('Level ', ''));
        return levelA - levelB;
    }).forEach(tier => {
        const tierLevel = parseInt(tier.replace('Level ', ''));
        const isLocked = tierLevel > gameState.level;
        
        marketHTML += `
            <div style="margin: 15px 0; padding: 10px; background: rgba(34, 197, 94, 0.05); border-radius: 10px;">
                <h3 style="color: ${isLocked ? '#ef4444' : '#4ade80'}; margin-bottom: 10px;">
                    ${tier} ${isLocked ? '🔒' : ''}
                </h3>
                <div class="market-grid">
        `;
        
        tiers[tier].forEach(plant => {
            const canAfford = gameState.coins >= plant.value;
            const isUnlocked = gameState.level >= plant.level;
            
            marketHTML += `
                <div class="market-item ${!isUnlocked ? 'locked' : ''}" 
                     onclick="${isUnlocked ? `buyPlant(${plant.id})` : 'showLockedMessage()'}">
                    <div class="market-item-icon">${plant.emoji}</div>
                    <div class="market-item-name" style="font-size: 10px;">${plant.name}</div>
                    <div class="market-item-price" style="color: ${canAfford ? '#fbbf24' : '#ef4444'}">
                        💰 ${plant.value}
                    </div>
                    ${!isUnlocked ? '<div style="font-size: 9px; color: #ef4444;">Locked</div>' : ''}
                </div>
            `;
        });
        
        marketHTML += '</div></div>';
    });
    
    marketHTML += '</div>';
    grid.innerHTML = marketHTML;
    modal.classList.add('active');
}

// Function to generate all 369 plants based on your CSV
function generateFullPlantList() {
    const plantNames = [
        'Abuta', 'Acai', 'Acerola', 'Achiote', 'Agrimony', 'Alfalfa', 'Algae Red Marine', 'Allspice',
        'Aloe Ferox', 'Aloe Vera', 'Amalaki', 'Amor Seco', 'Anamu', 'Andiroba', 'Angelica', 'Anise',
        'Apple Cider', 'Apple', 'Arnica', 'Arrowroot', 'Artichoke', 'Ashwagandha', 'Astragalus', 'Avocado',
        'Ayahuma', 'Ayapana', 'Babul Chall Gum', 'Balsam Fir Needles', 'Banisteriopsis Caapi', 'Barberry',
        'Barley Grass', 'Basil', 'Bat Petals Natural Sea Algae', 'Bay', 'Bayberry', 'Beet', 'Bellaco Caspi',
        'Benzoin Gum', 'Bhringraj', 'Bibhitaki', 'Bilberry', 'Birch', 'Bitter Melon', 'Black Cohosh',
        'Black Cumin', 'Black Currant', 'Black Walnut Hull', 'Blackberry', 'Bladderrack', 'Blessed Thistle',
        'Blood', 'Blue Lily', 'Blue Lotus', 'Blue Vervain', 'Bobinsana', 'Boneset', 'Boswellia Serrata',
        'Brahmi', 'Buckthorn', 'Buckwheat Hulls', 'Bufellio', 'Bupleurum', 'Burdock', 'Buriti',
        'Butchers Broom', 'Butterfly Pea', 'Butternut', 'Cacao Peru', 'Calamus', 'California Poppy',
        'Camu Camu', 'Cannabis', 'Caneleiro', 'Capinuri', 'Caraway', 'Cardamom', 'Carifillo', 'Carob',
        'Carrot', 'Cascara Sagrada', 'Cats Claw', 'Catnip', 'Cattail', 'Catuaba', 'Cayenne', 'Cedro',
        'Celery', 'Cetico', 'Chacruna', 'Chaga Mushroom', 'Chaliponga', 'Chaparral', 'Cherry', 'Chervil',
        'Chia', 'Chickweed', 'Chicory'
        // Add all 369 plant names here...
    ];
    
    return plantNames.map((name, index) => ({
        id: index + 1,
        name: name,
        emoji: getPlantEmoji(name),
        growTime: 30 + (index % 20) * 10, // 30-230 seconds
        value: Math.floor(10 + (index / 369) * 990), // 10-1000 coins progressive
        xp: Math.floor(5 + (index / 369) * 95), // 5-100 XP progressive
        level: Math.ceil((index + 1) / 15) // 15 plants per level = 25 levels total
    }));
}

function getPlantEmoji(name) {
    name = name.toLowerCase();
    if (name.includes('mushroom') || name.includes('chaga')) return '🍄';
    if (name.includes('berry')) return '🫐';
    if (name.includes('apple')) return '🍎';
    if (name.includes('cherry')) return '🍒';
    if (name.includes('lotus') || name.includes('lily')) return '🪷';
    if (name.includes('cacao') || name.includes('cocoa')) return '🍫';
    if (name.includes('pepper') || name.includes('cayenne')) return '🌶️';
    if (name.includes('root')) return '🌰';
    if (name.includes('bark') || name.includes('tree')) return '🌳';
    if (name.includes('flower')) return '🌸';
    if (name.includes('algae') || name.includes('seaweed')) return '🌊';
    if (name.includes('aloe') || name.includes('cactus')) return '🌵';
    return '🌿'; // default
}

// Add function to handle locked plants
function showLockedMessage() {
    showFloatingText('Level up to unlock!', event.clientX, event.clientY, '#ef4444');
}

// Add function to buy plants
function buyPlant(plantId) {
    const plant = generateFullPlantList().find(p => p.id === plantId);
    if (!plant) return;
    
    if (gameState.coins < plant.value) {
        showFloatingText('Not enough coins!', event.clientX, event.clientY, '#ef4444');
        return;
    }
    
    // Find empty plot
    const emptyPlot = gameState.plots.findIndex(p => p === null);
    if (emptyPlot === -1) {
        showFloatingText('No empty plots!', event.clientX, event.clientY, '#ef4444');
        return;
    }
    
    // Plant it
    gameState.coins -= plant.value;
    gameState.energy -= 5;
    
    gameState.plots[emptyPlot] = {
        plant: plant,
        plantedAt: Date.now(),
        growTime: plant.growTime * 1000,
        ready: false
    };
    
    updatePlot(emptyPlot, gameState.plots[emptyPlot]);
    updateUI();
    saveGame();
    closeModal('marketModal');
    
    showFloatingText(`Planted ${plant.name}!`, window.innerWidth / 2, 200, '#4ade80');
}
        // Visit neighbor
        function visitNeighbor(id) {
            showFloatingText(`Visiting neighbor's farm...`, window.innerWidth / 2, 200);
            // Would load neighbor's farm view
        }

        // Initialize
        initFarmGrid();
        updateUI();
        updateWeather();

        // Auto-save every 30 seconds
        setInterval(saveGame, 30000);

// Buy plant from market
function buyPlant(plantId) {
    const plant = gameState.plants.find(p => p.id === plantId);
    if (!plant) return;
    
    if (gameState.coins < plant.value) {
        showFloatingText('Not enough coins!', event.clientX, event.clientY, '#ef4444');
        return;
    }
    
    // Find empty plot
    const emptyPlot = gameState.plots.findIndex(p => p === null);
    if (emptyPlot === -1) {
        showFloatingText('No empty plots!', event.clientX, event.clientY, '#ef4444');
        return;
    }
    
    // Plant it
    gameState.coins -= plant.value;
    gameState.energy -= 5;
    
    gameState.plots[emptyPlot] = {
        plant: plant,
        plantedAt: Date.now(),
        growTime: plant.growTime * 1000,
        ready: false
    };
    
    updatePlot(emptyPlot, gameState.plots[emptyPlot]);
    updateUI();
    saveGame();
    closeModal('marketModal');
    
    showFloatingText(`Planted ${plant.name}!`, window.innerWidth / 2, 200, '#4ade80');
}

// Show locked message
function showLockedMessage() {
    showFloatingText('Level up to unlock!', event.clientX, event.clientY, '#ef4444');
}

// Building functions
function openGreenhouse() {
    showFloatingText('Greenhouse coming soon!', window.innerWidth / 2, 200);
}

function openApothecary() {
    showFloatingText('Apothecary coming soon!', window.innerWidth / 2, 200);
}

function openLibrary() {
    showFloatingText('Library coming soon!', window.innerWidth / 2, 200);
}

function openFishPond() {
    showFloatingText('Koi Pond coming soon!', window.innerWidth / 2, 200);
}

// Visit neighbor
function visitNeighbor(id) {
    showFloatingText('Visiting neighbor...', window.innerWidth / 2, 200);
}

// Social functions
function sendGift(friendId) {
    showFloatingText('Gift sent!', window.innerWidth / 2, 200);
}

function helpFriend(friendId) {
    showFloatingText('Helped friend!', window.innerWidth / 2, 200);
}

// Show plot info
function showPlotInfo(plotId) {
    const plot = gameState.plots[plotId];
    if (!plot) return;
    
    const timeLeft = (plot.plantedAt + plot.growTime) - Date.now();
    const seconds = Math.ceil(timeLeft / 1000);
    showFloatingText(`Ready in ${seconds} seconds`, event.clientX, event.clientY);
}

// Generate full plant list (if missing)
function generateFullPlantList() {
    return gameState.plants;
}
        // Initialize the game when page loads
window.addEventListener('load', function() {
    initFarmGrid();
    updateUI();
    updateWeather();
});
    </script>
</body>
</html>
